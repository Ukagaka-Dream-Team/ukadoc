<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="robots" content="INDEX,FOLLOW">
<meta name="author" content="UKADOC Project">
<meta name="keywords" content="ukadoc,ukagaka">
<title>UKADOC Project SHIORI/3.0</title>
<link rel="stylesheet" href="list.css" />
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
</head>
<body>
	<h1 id="page-title">SHIORI/3.0</h1>
	<nav class="menu-header">
		<table>
			<tbody>
				<tr>
					<th>Return to top page</th>
					<td colspan="2">
						<ul>
							<li><a href="https://ukagakadreamteam.github.io/ukadoc/manual/index.html">INDEX</a></li>
						</ul>
					</td>
				</tr>
			</tbody>
			<tbody>
				<tr>
					<th rowspan="6">Settings files</th>
					<th>Ghost</th>
					<td>
						<ul>
							<li><a href="./descript_ghost.html">descript.txt</a></li>
						</ul>
					</td>
				</tr>
				<tr>
					<th>Shell</th>
					<td>
						<ul>
							<li><a href="./descript_shell.html">descript.txt</a></li>
							<li><a href="./descript_shell_surfaces.html">surfaces.txt</a></li>
							<li><a href="./descript_shell_surfacetable.html">surfacetable.txt</a></li>
						</ul>
					</td>
				</tr>
				<tr>
					<th>Balloon</th>
					<td>
						<ul>
							<li><a href="./descript_balloon.html">descript.txt</a></li>
							<li><a href="./descript_balloon.html#balloonsoption">balloon(s/k)*s.txt</a></li>
						</ul>
					</td>
				</tr>
				<tr>
					<th>Plugin</th>
					<td>
						<ul>
							<li><a href="./descript_plugin.html">descript.txt</a></li>
						</ul>
					</td>
				</tr>
				<tr>
					<th>Headline</th>
					<td>
						<ul>
							<li><a href="./descript_headline.html">descript.txt</a></li>
						</ul>
					</td>
				</tr>
				<tr>
					<th>Install</th>
					<td>
						<ul>
							<li><a href="./descript_install.html">install.txt</a></li>
							<li><a href="./descript_install.html#delete.txt">delete.txt</a></li>
							<li><a href="./descript_install.html#developer_options.txt">developer_options.txt</a></li>
						</ul>
					</td>
				</tr>
			</tbody>
			<tbody>
				<tr>
					<th>SakuraScript</th>
					<td colspan="2">
						<ul>
							<li><a href="./list_sakura_script.html">Sakura Script</a></li>
							<li><a href="./list_propertysystem.html">Property System</a></li>
						</ul>
					</td>
				</tr>
			</tbody>
			<tbody>
				<tr>
					<th rowspan="2">Events</th>
					<th>SHIORI</th>
					<td>
						<ul>
							<li><a href="./list_shiori_event.html">SHIORI Event</a></li>
							<li><a href="./list_shiori_event_ex.html">SHIORI Event (External)</a></li>
							<li><a href="./list_shiori_resource.html">SHIORI Resource</a></li>
						</ul>
					</td>
				</tr>
				<tr>
					<th>PLUGIN</th>
					<td>
						<ul>
							<li><a href="./list_plugin_event.html">PLUGIN Event</a></li>
						</ul>
					</td>
				</tr>
			</tbody>
			<tbody>
				<tr>
					<th>Standards</th>
					<td colspan="2">
						<ul>
							<li><a href="./spec_shiori3.html">SHIORI/3.0</a></li>
							<li><a href="./spec_sstp.html">SSTP/1.x</a></li>
							<li><a href="http://www.boreas.dti.ne.jp/~sdn/saori.html">SAORI/1.0</a> (External site)</li>
							<li><a href="./spec_plugin.html">PLUGIN/2.0</a></li>
							<li><a href="./spec_headline.html">HEADLINE/2.0</a></li>
							<li><a href="./spec_dll.html">DLL</a></li>
							<li><a href="./spec_fmo_mutex.html">FMO/MUTEX</a></li>
							<li><a href="./spec_web.html">Web-related</a></li>
						</ul>
					</td>
				</tr>
			</tbody>
		</table>
	</nav>
	<section class="navigation-bar">
		<h1>SHIORI/3.0</h1>
		<section class="navigation-category">
			<h1>SHIORI/3.0</h1>
			<ul>
				<li><a href="#capability">Detection of implementation response status</a></li>
				<li><a href="#request">request</a></li>
				<li><a href="#response">response</a></li>
			</ul>
		</section>
	</section>
	<div class="categories">
		<section class="caption" id="notes_translation">
			<h1>Translated Document</h1>
			<ul>
				<li>This document has been translated from the original Japanese by members of the Ukagaka Dream Team community.</li>
				<li>To see the original document, click <a href="https://ssp.shillest.net/ukadoc/manual/spec_shiori3.html">here</a>.</li>
				<li>To submit corrections/updates, see <a href="https://github.com/Ukagaka-Dream-Team/ukadoc">our repository</a> to open an issue or find where to contact us.</li>
			</ul>
		</section>
		<section class="category caption introduction" id="chapter0">
			<h1>SHIORI/3.0</h1>
			<p>Reference: <a href="http://usada.sakura.vg/contents/specification2.html#shioriprotocol">SHIORI/3.0</a> (External site) <a href="http://usada.sakura.vg/contents/shiori.html">SHIORI/2.x</a> (External site)</p>
		</section>
		
		<section class="category" id="capability">
			<h1>Detection of implementation response status</h1>
			<section class="caption">
				<p>The implementation support status of extension headers is notified at the beginning of SHIORI execution using <a href="./list_shiori_event.html#capability">ID: capability</a>.</p>
			</section>
		</section>
		
		<section class="category" id="request">
			<h1>request</h1>
			<section class="caption">
			<h1>Sample</h1>
<pre><!--
-->GET SHIORI/3.0
Charset: UTF-8
Sender: SSP
SenderType: internal,raise
SecurityLevel: local
Status: choosing,balloon(0=0)
ID: OnFirstBoot
BaseID: OnBoot
Reference0: 1

</pre>
			<p>※The line feed code is CR+LF
			<br />※Terminate with a blank line ((CR+LF)x2 at the end of the last line).</p>
			</section>
			<dl>
				<dt class="entry">Method</dt>
				<dd class="entry">
				<dl class="property">
					<dt>GET</dt>
					<dd>A method that assumes that something will be returned in the Value header of the response.</dd>
					<dt>NOTIFY</dt>
					<dd>A method that is not expected to return any value. The Value header of the response is ignored.<br>
					It is mainly used when "unable to speak" due to some mode restriction, or for status notification events immediately after startup.<br>
					Note that the same ID (event name) may use both GET and NOTIFY.</dd>
				</dl>				</dd>
				
				<dt class="entry">Charset</dt>
				<dd class="entry"><p>Character code. Preferably before the first line, or at least before any line whose character code is not in the ASCII range.</p></dd>
				
				<dt class="entry">Sender</dt>
				<dd class="entry"><p>Event source.</p></dd>
				
				<dt class="entry">SenderType [Extended in SSP 2.5.05]</dt>
				<dd class="entry">
				<p>Attributes of the event source. The following attributes are used. If there is more than one, they are connected by commas.<br>
				For ID: OnTranslate, the attributes of the translate-source event are inherited.</p>
				<dl class="property">
					<dt>internal</dt>
					<dd>Events from inside the application. </dd>
					<dt>external</dt>
					<dd>Events from outside the application. </dd>
					<dt>sakuraapi</dt>
					<dd>An event caused by Sakura API. </dd>
					<dt>embed</dt>
					<dd>An event caused by the \![embed] tag. </dd>
					<dt>raise</dt>
					<dd>An event caused by the \![raise] tag. </dd>
					<dt>property</dt>
					<dd>An event caused as a result of a property system reference instruction. </dd>
					<dt>plugin</dt>
					<dd>An event caused by a plugin. </dd>
					<dt>sstp</dt>
					<dd>An event caused by SSTP. </dd>
					<dt>communicate</dt>
					<dd>An event caused by a communicate specification.</dd>
				</dl>
				</dd>
				
				<dt class="entry">SecurityLevel</dt>
				<dd class="entry">
				<p>Security level when executing the script. One of the following.
				<br />For ID: OnTranslate, the attributes of the translate-source event are inherited.</p>
				<br />Notified on the first line if at all possible. It should appear at least before the ID header.</p>
				<dl class="property">
					<dt>local</dt>
					<dd>Notifications from within the running terminal.</dd>
					<dt>external</dt>
					<dd>Notifications from outside the running terminal.</dd>
				</dl>
				<p>In the case of external, it is a notification from outside the running system, so it should be handled with caution for security reasons.<br>
				The concept is different from internal/external of SenderType. Even if the event is generated from outside the application, it will be judged as local if it can be regarded as safe, so the SecurityLevel may be local even if the SenderType is external.</p>
				</dd>
				
				<dt class="entry">Status [SSP Extension]</dt>
				<dd class="entry">
				<p>Ghost running state. As follows. If there is more than one, they are connected by commas.</p>
				<dl class="property">
					<dt>talking</dt>
					<dd>In the middle of talking. </dd>
					<dt>choosing</dt>
					<dd>Displaying menu choices. </dd>
					<dt>minimizing</dt>
					<dd>When minimized. </dd>
					<dt>induction</dt>
					<dd>During \![enter,inductionmode]. </dd>
					<dt>passive</dt>
					<dd>During \![enter,passivemode]. </dd>
					<dt>timecritical</dt>
					<dd>During time critical section (\t). </dd>
					<dt>nouserbreak</dt>
					<dd>During \![enter,nouserbreak]. </dd>
					<dt>online</dt>
					<dd>Network communication in progress. </dd>
					<dt>opening(type)</dt>
					<dd>An input box, etc., is open.<br>
					If multiple types are open, they are listed with / as the delimiter.<br>
					"dialog" is for file selection, color picker, etc.<br>
					Example: opening(communicate/input/teach/dialog)</dd>
					<dt>balloon(ID group)</dt>
					<dd>Balloon is displayed.<br>
					Listed in the format character ID=balloon ID.<br>
					If more than one is open, they are listed with / as the delimiter.<br>
					Example: balloon(0=2/1=0), where \0 indicates a large balloon is being displayed and \1 indicates a normal balloon is being displayed.
					</dd>
				</dl>
				</dd>
				<dt class="entry">ID</dt>
				<dd class="entry"><p>Event name or resource identifier</p></dd>
				
				<dt class="entry">BaseID [SSP Extension]</dt>
				<dd class="entry"><p>Compatible base event names.<br>
				Example: Since OnFirstBoot is compatible with OnBoot, and OnFirstBoot is a variant of OnBoot, OnFirstBoot's BaseID will contain OnBoot.</p></dd>
				
				<dt class="entry">Reference*</dt>
				<dd class="entry"><p>Additional information accompanying the event. A number is included after Reference. The number of lines is unlimited (as long as memory allows).</p></dd>
				
				<dt class="entry">X-SSTP-PassThru-(Arbitrary string) [Extended in SSP 2.5.05]</dt>
				<dd class="entry"><p>If and only if an event notification is received from SSTP, the SSTP request header beginning with "X-SSTP-PassThru-" will be notified as is. <br>
				Not added when it is not SSTP.</p></dd>
			</dl>
		</section>
		<section class="category" id="response">
			<h1>response</h1>
			<section class="caption">
				<h1>Sample</h1>
<pre><!--
-->SHIORI/3.0 200 OK
Charset: UTF-8
Sender: AYA
Value: \1\s[10]\0\s[0]\e

</pre>
				<p>※The line feed code is CR+LF
				<br />※Terminate with a blank line ((CR+LF)x2 at the end of the last line).</p>
			</section>

			<dl>
				<dt class="entry">Status code</dt>
				<dd class="entry">
				<p>As with HTTP, the number 200 indicates success, while the others indicate some kind of failure (error).<br>
				Currently, the following are primarily used.</p>
				<dl class="property">
					<dt>200</dt>
					<dd>200 OK<br>Success, return value (Value) exists.</dd>
					
					<dt>204</dt>
					<dd>204 No Content<br>Success, no return value.</dd>
					
					<dt>311</dt>
					<dd>311 Not Enough<br>Indicates that additional information is required in ID: OnTeach (SHIORI/2 series TEACH method).<br>
					Reopen the input box, ask the user, and add a Reference containing the input string after input is complete.</dd>
					
					<dt>312</dt>
					<dd>312 Advice<br>Indicates that the most recently input string in ID: OnTeach (SHIORI/2 series TEACH method) is uninterpretable and should be discarded.<br>
					Discard the last Reference, reopen the input box, ask the user, and add a Reference containing the input string after input is complete.</dd>
					
					<dt>400</dt>
					<dd>400 Bad Request<br>Request string was uninterpretable.</dd>
					
					<dt>500</dt>
					<dd>500 Internal Server Error<br>Some error occured within SHIORI and a response could not be returned.</dd>
				</dl>
				</dd>
				<dt class="entry">Charset</dt>
				<dd class="entry"><p>Character code. Preferably before the first line, or at least before any line whose character code is not in the ASCII range.</p></dd>
				
				<dt class="entry">Sender</dt>
				<dd class="entry"><p>Sender. Usually the name of the SHIORI.</p></dd>
				
				<dt class="entry">Value</dt>
				<dd class="entry"><p>Script to be spoken.</p></dd>
				
				<dt class="entry">ValueNotify [SSP Extension 2.5.35]</dt>
				<dd class="entry"><p><em>[Experimental feature]</em>
				<br />Extension for executing SakuraScript even when the request method is NOTIFY.
				<br />If SakuraScript is returned with this header, it is executed immediately.
				<br />The number of tags that can be executed is extremely limied; all other tags and strings are ignored.
				<br />It is ignored when the method is not NOTIFY or if the Value header is already present.
				<br />Currently, the following tags can be executed:</p>
				<ul>
				<li>\![sound]</li>
				<li>\![set,trayicon]</li>
				<li>\![set,trayballoon]</li>
				<li>\![raise] (It works the same as NOTIFY)</li>
				<li>\![raiseother] (It works the same as NOTIFY)</li>
				<li>\![raiseplugin] (It works the same as NOTIFY)</li>
				<li>\![timerraiseother] (The event will be treated as a NOTIFY event)</li>
				<li>\![timerraiseplugin] (The event will be treated as a NOTIFY event)</li>
				<li>\![notify]</li>
				<li>\![notifyother]</li>
				<li>\![notifyplugin]</li>
				</ul>
				</dd>

				<dt class="entry">SecurityLevel [SSP Extension]</dt>
				<dd class="entry">
				<p>One of the following.</p>
				<dl class="property">
					<dt>local</dt>
					<dd>Security level equivalent to scripts from inside the running terminal.</dd>
					<dt>external</dt>
					<dd>Security level equivalent to scripts from outside the running terminal.</dd>
				</dl>
				<p>SecurityLevel of the script to be spoken. If it is external, some scripts will not be able to be executed due to security features.</p></dd>
				
				<dt class="entry">Marker [SSP Extension]</dt>
				<dd class="entry"><p>String to be displayed on the balloon marker (additional information on the underside of the ballon).</p></dd>
				
				<dt class="entry">ErrorLevel [SSP Extension]</dt>
				<dd class="entry"><p>The level of error that occurred inside the SHIORI. One of the following. To express multiple errors, separate them with a byte value of 1.</p>
				<dl class="property">
					<dt>info</dt>
					<dd>Information. Not an error.</dd>
					<dt>notice</dt>
					<dd>Notice. A description that is not an error but should be corrected, etc.</dd>
					<dt>warning</dt>
					<dd>Warning. A warning is a description error that should be addressed, although the process has not been stopped.</dd>
					<dt>error</dt>
					<dd>Normal error. Something has stopped due to a description error, etc., and cannot be resumed.</dd>
					<dt>critical</dt>
					<dd>Fatal error, worse than a normal error and needs to be addressed immediately.</dd>
				</dl>				
				<p>If this header is present, the user is notified that an error has occurred.<br>
				The level of notification is user-configurable. Usually, it is error or higher.<br>
				In the case of SSP, it is recorded in the error log and an error icon appears in the notification area.</p></dd>
				
				<dt class="entry">ErrorDescription [SSP Extension]</dt>
				<dd class="entry"><p>Detailed information on errors that occurred inside the SHIORI. Valid only if ErrorLevel is present.<br>
				To express multiple errors, separate them with a byte value of 1<br>
				The number of elements in ErrorLevel and ErrorDescription must be the same.</p></dd>
				
				<dt class="entry">BalloonOffset [SSP Extension]</dt>
				<dd class="entry"><p>Offset value (X,Y) of the balloon.</p></dd>
				
				<dt class="entry">Reference0</dt>
				<dd class="entry"><p>Name of the \0 side of the ghost if you want to send a communication.</p></dd>
				
				<dt class="entry">Reference1+</dt>
				<dd class="entry"><p>Additional information for communication.<br>
				Reference1 in response = Reference0 in SSTP communicate = Reference2 in the receiver's OnCommunicate.<br>
				Note that the above is out of alignment due to compatibility issues.</p></dd>
				
				<dt class="entry">Age [SSP Extension]</dt>
				<dd class="entry"><p>Number of generations of communication. 0 for the first time, +1 for each successive exchange.<br>
				Although it is an SSP extension, it is actually SHIORI/2.x compatible processing.</p></dd>
				
				<dt class="entry">MarkerSend [SSP Extension]</dt>
				<dd class="entry"><p>A balloon marker string that you want to display "to the other side" while communicating.<br>
				Sent as a Marker header of SSTP.</p></dd>
				
				<dt class="entry">X-SSTP-PassThru-(Arbitrary string) [Extended in SSP 2.5.03]</dt>
				<dd class="entry"><p>If and only if an event notification is received from SSTP, this header is added to the SSTP response as it is.<br>
				Not added when it is not SSTP.<br>
				Multiple headers can be specified, but if you want to return more than one, change the header name.<br>
				(Old header name: X-SSTP-Return- , will be deprecated.)</p></dd>
			</dl>
		</section>
	</div>
</body>
</html>